<!DOCTYPE html>
<html lang="de"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zahlung - IU Cinema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="../assets/css/styles.css" rel="stylesheet" />
    <link href="../assets/css/booking-styles.css" rel="stylesheet" />
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.xhtml">IU Cinema</a>
    </div>
</nav>

<div class="container mt-4 mt-lg-5">
    <div class="row g-4">
        <!-- Left Column - Payment Section -->
        <div class="col-12 col-lg-8">
            <div class="booking-section">
                <h2 class="mb-3 mb-lg-4">Zahlung</h2>

                <!-- Billing Address Form -->
                <form id="billingForm" class="mb-4">
                    <h3 class="mb-3">Rechnungsadresse</h3>
                    <div class="row g-3">
                        <div class="col-12 col-sm-6">
                            <label for="firstName" class="form-label">Vorname</label>
                            <input type="text" class="form-control" id="firstName" required="" />
                        </div>
                        <div class="col-12 col-sm-6">
                            <label for="lastName" class="form-label">Nachname</label>
                            <input type="text" class="form-control" id="lastName" required="" />
                        </div>
                    </div>

                    <div class="mt-3">
                        <label for="email" class="form-label">E-Mail</label>
                        <input type="email" class="form-control" id="email" required="" />
                    </div>

                    <div class="mt-3">
                        <label for="street" class="form-label">Straße und Hausnummer</label>
                        <div class="row">
                            <div class="col-10">
                                <input type="text" class="form-control" id="street" required="" />
                            </div>
                            <div class="col-2">
                                <input type="text" class="form-control" id="houseNumber" required="" />
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-12 col-sm-4">
                            <label for="zipCode" class="form-label">PLZ</label>
                            <input type="text" class="form-control" id="zipCode" required="" />
                        </div>
                        <div class="col-12 col-sm-8">
                            <label for="city" class="form-label">Stadt</label>
                            <input type="text" class="form-control" id="city" required="" />
                        </div>
                    </div>

                    <!-- Ticket Holder Information -->
                    <h3 class="mb-3 mt-4">Ticketinhaber</h3>
                    <div id="ticketHolderSection" class="ticket-holders accordion">
                        <!-- Dynamically added ticket holders will appear here -->
                    </div>

                    <!-- Payment Method Selection -->
                    <h3 class="mb-3 mt-4">Zahlungsmethode</h3>
                    <div class="payment-methods">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="paypal" value="paypal" checked="" />
                            <label class="form-check-label" for="paypal">
                                <i class="bi bi-paypal me-2"></i>PayPal
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="sepa" value="sepa" />
                            <label class="form-check-label" for="sepa">
                                <i class="bi bi-bank me-2"></i>SEPA-Lastschrift
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="creditCard" />
                            <label class="form-check-label" for="creditCard">
                                <i class="bi bi-credit-card me-2"></i>Kreditkarte
                            </label>
                        </div>
                    </div>

                    <!-- SEPA Fields -->
                    <div id="sepaFields" class="mt-3" style="display: none;">
                        <h4>SEPA-Informationen</h4>
                        <div class="mb-3">
                            <label for="iban" class="form-label">IBAN</label>
                            <input type="text" id="iban" class="form-control" placeholder="DE00 1234 1234 1234 1234 00" required="" />
                        </div>
                        <div class="mb-3">
                            <label for="bic" class="form-label">BIC</label>
                            <input type="text" id="bic" class="form-control" placeholder="GENODE00XXX" required="" />
                        </div>
                    </div>

                    <!-- Credit Card Fields -->
                    <div id="creditCardFields" class="mt-3" style="display: none;">
                        <h4>Kreditkarteninformationen</h4>
                        <div class="mb-3">
                            <label for="cardNumber" class="form-label">Kartennummer</label>
                            <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" required="" />
                        </div>
                        <div class="row g-3">
                            <div class="col-6">
                                <label for="expiryDate" class="form-label">Ablaufdatum</label>
                                <input type="text" id="expiryDate" class="form-control" placeholder="MM/JJ" required="" />
                            </div>
                            <div class="col-6">
                                <label for="cvv" class="form-label">CVV</label>
                                <input type="text" id="cvv" class="form-control" placeholder="123" required="" />
                            </div>
                        </div>
                    </div>

                    <input type="hidden" name="movieId" value="#{bookingBean.getMovie().movieId}" />
                    <button type="submit" class="btn btn-primary w-100 mt-4">Jetzt Bezahlen</button>
                </form>
            </div>
        </div>

        <!-- Right Column - Booking Summary -->
        <div class="col-lg-4">
            <div class="booking-summary">
                <h3>Buchungsübersicht</h3>
                <div class="movie-info-booking">
                    <img id="movieImage" src="#{bookingBean.getMovie().cover}" alt="Movie Poster" class="img-fluid rounded mb-3" />
                    <h4 id="movieTitle">#{bookingBean.getMovie().name}</h4>
                    <p id="movieDetails" style="color: #cccccc">#{bookingBean.getMovie().shortDesc}</p>
                    <div class="movie-info">
                        <ui:repeat var="genre" value="#{movieBean.getGenres(bookingBean.getMovie())}">
                            <span class="badge bg-info">#{genre}</span>
                        </ui:repeat>
                        <span class="duration">#{bookingBean.getMovie().playtime} Spielzeit</span>
                    </div>
                </div>

                <div class="selected-seats-info mt-4">
                    <h5>Ausgewählte Sitze</h5>
                    <ul id="selectedSeatsList" class="list-unstyled">
                        <!-- Selected seats will be listed here -->
                    </ul>
                </div>

                <div class="price-summary mt-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Preis pro Ticket:</span>
                        <span id="price-per-ticket">#{bookingBean.getMovie().price} €</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2 total-price">
                        <strong>Gesamtpreis:</strong>
                        <strong id="totalPrice">0.00 €</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<h:form id="paymentForm" style="display: none;">
    <h:inputHidden id="movieId" value="#{paymentBean.movieId}" />
    <h:inputHidden id="total" value="#{paymentBean.total}" />
    <h:inputHidden id="ticketHolders" value="#{paymentBean.ticketHolders}" />
    <h:inputHidden id="billingInfo" value="#{paymentBean.billingInfo}" />
    <h:commandButton id="submitButton" value="Submit" action="#{paymentBean.submit}" />
</h:form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/js/payment.js"></script>
</body>
</html>
